<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>civi 对象 | 框架开发文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="框架开发文档">
    
    <link rel="preload" href="/document/plugin/assets/css/0.styles.c91098de.css" as="style"><link rel="preload" href="/document/plugin/assets/js/app.e2cef265.js" as="script"><link rel="preload" href="/document/plugin/assets/js/2.b03c367c.js" as="script"><link rel="preload" href="/document/plugin/assets/js/7.0a6ee148.js" as="script"><link rel="prefetch" href="/document/plugin/assets/js/10.392b02cc.js"><link rel="prefetch" href="/document/plugin/assets/js/11.127ca943.js"><link rel="prefetch" href="/document/plugin/assets/js/12.55ade8a1.js"><link rel="prefetch" href="/document/plugin/assets/js/13.8306b398.js"><link rel="prefetch" href="/document/plugin/assets/js/14.a2fa0af5.js"><link rel="prefetch" href="/document/plugin/assets/js/15.ce797401.js"><link rel="prefetch" href="/document/plugin/assets/js/16.0f126e96.js"><link rel="prefetch" href="/document/plugin/assets/js/17.0185c360.js"><link rel="prefetch" href="/document/plugin/assets/js/18.e9b404c4.js"><link rel="prefetch" href="/document/plugin/assets/js/19.b6a99c82.js"><link rel="prefetch" href="/document/plugin/assets/js/20.0a1396b7.js"><link rel="prefetch" href="/document/plugin/assets/js/21.59d0d3d4.js"><link rel="prefetch" href="/document/plugin/assets/js/3.cfeb10e0.js"><link rel="prefetch" href="/document/plugin/assets/js/4.2a5d96fc.js"><link rel="prefetch" href="/document/plugin/assets/js/5.fd255a4a.js"><link rel="prefetch" href="/document/plugin/assets/js/6.66b67ff0.js"><link rel="prefetch" href="/document/plugin/assets/js/8.36df54d6.js"><link rel="prefetch" href="/document/plugin/assets/js/9.090970c7.js">
    <link rel="stylesheet" href="/document/plugin/assets/css/0.styles.c91098de.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/document/plugin/" class="home-link router-link-active"><!----> <span class="site-name">框架开发文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>云服务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/plugin/server/" class="sidebar-link">云服务文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>主框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/plugin/main/" aria-current="page" class="sidebar-link">主框架开发文档</a></li><li><a href="/document/plugin/main/civi/" aria-current="page" class="active sidebar-link">civi对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#root-pathx" class="sidebar-link">ROOT_PATHx</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#app-path" class="sidebar-link">APP_PATH</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#runtime-path" class="sidebar-link">RUNTIME_PATH</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#isdev" class="sidebar-link">isDev</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#app" class="sidebar-link">app</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#config" class="sidebar-link">config</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#logs" class="sidebar-link">logs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#success" class="sidebar-link">success</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#error" class="sidebar-link">error</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#warn" class="sidebar-link">warn</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#debug" class="sidebar-link">debug</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#info" class="sidebar-link">info</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#uuid" class="sidebar-link">uuid</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#controller" class="sidebar-link">Controller</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#ctx" class="sidebar-link">ctx</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#header" class="sidebar-link">header</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#ffmpeg" class="sidebar-link">ffmpeg</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#getrtspimage" class="sidebar-link">getRtspImage</a></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#imgstovideo" class="sidebar-link">imgsToVideo</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#basecontroller" class="sidebar-link">BaseController</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/plugin/main/civi/#plg" class="sidebar-link">plg</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/plugin/plg/files/" class="sidebar-link">文件说明</a></li><li><a href="/document/plugin/plg/describe/" class="sidebar-link">描述文件</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>后端插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/plugin/plg/backend/" class="sidebar-link">初始化</a></li><li><a href="/document/plugin/plg/backend/push/" class="sidebar-link">算法推流</a></li><li><a href="/document/plugin/plg/backend/controller/" class="sidebar-link">控制器</a></li><li><a href="/document/plugin/plg/backend/model/" class="sidebar-link">数据模型</a></li><li><a href="/document/plugin/plg/backend/tips/" class="sidebar-link">注意事项</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>前端插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/plugin/plg/webvue/" class="sidebar-link">入口文件</a></li><li><a href="/document/plugin/plg/webvue/http/" class="sidebar-link">HTTP请求</a></li><li><a href="/document/plugin/plg/webvue/wss/" class="sidebar-link">WebSocket</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="civi-对象"><a href="#civi-对象" class="header-anchor">#</a> <code>civi</code> 对象</h1> <h2 id="root-pathx"><a href="#root-pathx" class="header-anchor">#</a> ROOT_PATHx</h2> <ul><li><code>类型</code> string</li> <li><code>说明</code> 项目根目录</li></ul> <h2 id="app-path"><a href="#app-path" class="header-anchor">#</a> APP_PATH</h2> <ul><li><code>类型</code> string</li> <li><code>说明</code> 项目根下的<code>src</code>目录</li></ul> <h2 id="runtime-path"><a href="#runtime-path" class="header-anchor">#</a> RUNTIME_PATH</h2> <ul><li><code>类型</code> string</li> <li><code>说明</code> 项目运行产生的文件，存放缓存，session和日志等文件</li></ul> <h2 id="isdev"><a href="#isdev" class="header-anchor">#</a> isDev</h2> <ul><li><code>类型</code> boolean</li> <li><code>说明</code> 是否开发环境</li></ul> <h2 id="app"><a href="#app" class="header-anchor">#</a> app</h2> <ul><li><code>类型</code> Koa</li> <li><code>说明</code> Koa服务的实例</li></ul> <h2 id="config"><a href="#config" class="header-anchor">#</a> config</h2> <ul><li><code>类型</code> object</li> <li><code>说明</code> 配置信息</li></ul> <h2 id="logs"><a href="#logs" class="header-anchor">#</a> logs</h2> <h3 id="success"><a href="#success" class="header-anchor">#</a> success</h3> <ul><li>成功日志 <code>civi.logs.success('输出信息')</code></li></ul> <h3 id="error"><a href="#error" class="header-anchor">#</a> error</h3> <ul><li>错误日志 <code>civi.logs.error('输出信息')</code></li></ul> <h3 id="warn"><a href="#warn" class="header-anchor">#</a> warn</h3> <ul><li>警告日志 <code>civi.logs.warn('输出信息')</code></li></ul> <h3 id="debug"><a href="#debug" class="header-anchor">#</a> debug</h3> <ul><li>debug日志 <code>civi.logs.debug('输出信息')</code></li></ul> <h3 id="info"><a href="#info" class="header-anchor">#</a> info</h3> <ul><li>info日志 <code>civi.logs.info('输出信息')</code></li></ul> <h2 id="uuid"><a href="#uuid" class="header-anchor">#</a> uuid</h2> <ul><li><code>说明</code> 生成UUID</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>civi<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token string">'v1'</span><span class="token punctuation">)</span>

civi<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token string">'v4'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h2> <ul><li><code>类型</code> class</li> <li><code>说明</code> 控制器类</li></ul> <h3 id="ctx"><a href="#ctx" class="header-anchor">#</a> ctx</h3> <ul><li><code>类型</code> KoaCentext</li> <li><code>说明</code> Koa请求的上下文对象</li></ul> <h3 id="header"><a href="#header" class="header-anchor">#</a> header</h3> <ul><li><code>类型</code> function(name, value) : any</li> <li><code>说明</code> 获取请求的header参数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 获取参数</span>
<span class="token keyword">let</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>

<span class="token comment">// 设置header参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token string">'123456789'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ffmpeg"><a href="#ffmpeg" class="header-anchor">#</a> ffmpeg</h2> <ul><li><code>类型</code> object</li> <li><code>说明</code> 封装了一些媒体操作的方法</li></ul> <h3 id="getrtspimage"><a href="#getrtspimage" class="header-anchor">#</a> getRtspImage</h3> <ul><li><code>类型</code> (rtsp: string): Promise&lt;string&gt;</li> <li><code>说明</code> 验证rtsp连接的有效性，并返回预览图片</li></ul> <h3 id="imgstovideo"><a href="#imgstovideo" class="header-anchor">#</a> imgsToVideo</h3> <ul><li><code>类型</code> (...params): Promise&lt;any&gt;
<ul><li>source 输入源</li> <li>fps 视频帧数</li> <li>output 视频输出路径</li> <li>start 视频输出路径</li> <li>time 视频时长/秒</li> <li>size 视频分辨率</li></ul></li> <li><code>说明</code> 批量图片合成视频文件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> source <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>tempPath<span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'%01d.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> video <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>resPath<span class="token punctuation">,</span> vid <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'.mp4'</span><span class="token punctuation">)</span> <span class="token comment">// 视频地址</span>
<span class="token keyword">await</span> civi<span class="token punctuation">.</span>ffmpeg<span class="token punctuation">.</span><span class="token function">imgsToVideo</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="basecontroller"><a href="#basecontroller" class="header-anchor">#</a> BaseController</h2> <ul><li><code>类型</code> class</li> <li><code>说明</code> 继承与<code>Controller</code> 类拥有Controller类的全部方法和属性 用于插件的控制器实例</li></ul> <h3 id="plg"><a href="#plg" class="header-anchor">#</a> plg</h3> <ul><li><code>类型</code> Plugin</li> <li><code>说明</code> 对应当前插件的实例</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/document/plugin/main/" class="prev router-link-active">
        主框架开发文档
      </a></span> <span class="next"><a href="/document/plugin/plg/files/">
        文件说明
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/document/plugin/assets/js/app.e2cef265.js" defer></script><script src="/document/plugin/assets/js/2.b03c367c.js" defer></script><script src="/document/plugin/assets/js/7.0a6ee148.js" defer></script>
  </body>
</html>
